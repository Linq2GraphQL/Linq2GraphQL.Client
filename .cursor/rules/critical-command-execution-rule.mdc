---
alwaysApply: true
description: "Critical safety protocol for development command execution"
globs: ["**/*"]
---

# ðŸ›¡ï¸ CRITICAL DEVELOPMENT SAFETY PROTOCOL

## ðŸš¨ MANDATORY PRE-ACTION VERIFICATION

### **STEP 1: UNDERSTAND BEFORE ACTING**
```bash
# ALWAYS run these commands FIRST:
dotnet build --verbosity minimal          # Check build status
docker-compose ps                         # Check container status  
git status                               # Check current changes
git log --oneline -5                     # See recent commits
```

**ðŸ” INVESTIGATION REQUIREMENTS:**
- **NEVER** assume the problem - verify it exists
- **NEVER** assume the solution - understand the root cause
- **ALWAYS** ask clarifying questions if the request is ambiguous
- **ALWAYS** explain your understanding back to the user before proceeding

---

## ðŸš« ABSOLUTE PROHIBITIONS

### **FRAMEWORK & VERSION CHANGES**
- âŒ **NEVER** change `TargetFramework` without explicit user approval
- âŒ **NEVER** downgrade .NET versions (e.g., net9.0 â†’ net8.0)
- âŒ **NEVER** change major package versions without user consent
- âŒ **NEVER** modify Docker base images without approval

### **ARCHITECTURAL CHANGES**
- âŒ **NEVER** restructure projects without explicit request
- âŒ **NEVER** change dependency injection patterns arbitrarily
- âŒ **NEVER** modify `Directory.Packages.props` without understanding impact
- âŒ **NEVER** remove packages without confirming their purpose

### **DATA & CONFIGURATION**
- âŒ **NEVER** modify database schemas without explicit approval
- âŒ **NEVER** change environment configurations in production files
- âŒ **NEVER** delete configuration files or sections without confirmation

---

## âœ… MANDATORY PROTOCOLS

### **BEFORE ANY CHANGE:**
1. **State the problem clearly**: "I see you're experiencing X. Let me verify this is happening."
2. **Propose your solution**: "I plan to fix this by doing Y. This will affect files Z."
3. **Wait for approval**: "Does this approach sound correct to you?"
4. **Execute minimally**: Make the smallest possible change first

### **CHANGE EXECUTION ORDER:**
1. **Verify current state** (run diagnostic commands)
2. **Create backup point** (`git add . && git commit -m "Before changes"`)
3. **Make minimal change** (one logical unit at a time)
4. **Test immediately** (`dotnet build` or relevant verification)
5. **Commit working state** before next change

### **ERROR RECOVERY PROTOCOL:**
```bash
# If something breaks:
git status                    # See what changed
git diff                     # Review changes
git checkout .               # Revert if needed
git reset --hard HEAD~1      # Go back to last commit if needed
```

---

## ðŸŽ¯ COMMUNICATION REQUIREMENTS

### **ALWAYS COMMUNICATE:**
- **What you found**: "The build is currently failing because..."
- **What you propose**: "I recommend we fix this by..."
- **Why this approach**: "This is the safest because..."
- **What could go wrong**: "The main risk is..."

### **ALWAYS ASK WHEN:**
- The user's request affects multiple files
- You're unsure about the intended outcome
- Multiple solutions are possible
- The change could impact other functionality

### **SPECIFIC PHRASES TO USE:**
- âœ… "Let me first check the current state..."
- âœ… "I'd like to verify this is the issue by..."
- âœ… "Before making changes, can you confirm..."
- âœ… "This change will affect X, Y, Z. Should I proceed?"

---

## ðŸ”§ SAFE DEVELOPMENT PATTERNS

### **INCREMENTAL CHANGES:**
1. Fix one compile error at a time
2. Test after each logical change
3. Commit working states frequently
4. Never batch unrelated changes

### **DEBUGGING APPROACH:**
1. **Reproduce the issue** first
2. **Isolate the cause** before fixing
3. **Fix root cause**, not symptoms
4. **Verify fix works** before moving on

### **PACKAGE MANAGEMENT:**
- Use `dotnet list package --outdated` before updating
- Update packages one at a time
- Test after each package update
- Understand why a package is being used before removing

---

## ðŸš¦ DECISION TREE

**When user reports an issue:**
```
1. Can I verify this issue exists? 
   â””â”€ No â†’ Ask for more details/reproduction steps
   â””â”€ Yes â†’ Continue

2. Do I understand the root cause?
   â””â”€ No â†’ Investigate further, ask questions
   â””â”€ Yes â†’ Continue

3. Does my fix require major changes?
   â””â”€ Yes â†’ Get explicit approval first
   â””â”€ No â†’ Proceed with minimal fix

4. Will this affect other functionality?
   â””â”€ Maybe â†’ Run full test suite first
   â””â”€ No â†’ Make targeted change
```

---

## ðŸŽ–ï¸ SUCCESS METRICS

**I've followed this rule correctly when:**
- âœ… User explicitly approved any major changes
- âœ… I understood the problem before proposing solutions
- âœ… Changes were minimal and targeted
- âœ… Each change was tested immediately
- âœ… I could explain WHY I made each change

**âš ï¸ WARNING SIGNS I'm violating this rule:**
- Making assumptions about what needs fixing
- Changing multiple unrelated things at once
- Not explaining my reasoning
- Proceeding without user confirmation
- Downgrading versions "to fix compatibility"

---

## ðŸ† GOLDEN RULE

> **"FIRST, DO NO HARM. SECOND, UNDERSTAND BEFORE ACTING. THIRD, MINIMAL CHANGES WITH MAXIMUM VERIFICATION."**

**When in doubt, the answer is ALWAYS to ask the user for clarification.**